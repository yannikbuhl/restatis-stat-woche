{
  "hash": "69b7d1e2628ce7a18396322734184fd7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"{restatis}\"\nsubtitle: \"Ein Softwarepaket für R zur Arbeit mit Zensusdatenbank, GENESIS und regionalstatistik.de\"\nauthor: \"Yannik Buhl, Statistisches Bundesamt\"\ninstitute: \"Statistische Woche 2024, Regensburg\"\nformat: \n  revealjs: \n    multiplex: true\n    theme: [\"pp.scss\"]\n    slide-number: c/t\n    fontcolor: \"#262d36\"\n    highlight-style: ayu-mirage\n    height: 900\n    width: 1600\ninclude-in-header:\n  - text: |\n      <style type=\"text/css\">\n      ul li ul li {\n        font-size: 0.8em;\n      }\n      \n      .figure {\n      margin: 0 !important;\n      }\n      \n      </style>\n---\n\n\n## Was ist `{restatis}` und was bringt es mit?\n\n<br>\n\n::: columns\n::: {.column width=\"50%\"}\n### Das Paket\n\n-   API-Wrapper für:\n    -   GENESIS (StBA-Datenbank)\n    -   Zensusdatenbank <br> (Zensus 2022)\n    -   www.regionalstatistik.de\n-   Entwickelt als Projekt <br> von [CorrelAid](www.correlaid.org)\n    -   Keine Zugehörigkeit zum StBA <br> oder dem Statistischen Verbund!\n    -   Erste Version 2023,<br> Update 2024\n:::\n\n::: {.column width=\"50%\"}\n### Features\n\n-   Durchsuche Datenbanken nach:\n\n    -   Tabellen & Cubes <br> (inkl. EVAS-Codes)\n    -   Metadaten, Variablen, Werte, etc.\n\n-   Datendownload <br> (Tabellen, Cubes)\n\n-   Weitere Informationen abrufbar <br> (z.B. Qualitätskennzeichen)\n\n-   Caching von API-Calls <br> mit `memoise`\n\n    -   R-Session neu starten für Reset\n:::\n:::\n\n## Installation\n\n<br>\n\n-   Installation über CRAN:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# CRAN-Veröffentlichung\ninstall.packages(\"restatis\")\n```\n:::\n\n\n<br>\n\n-   Entwicklungsversion über GitHub-Repository\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Development-Version\nremotes::install_github(\"CorrelAid/restatis\")\n```\n:::\n\n\n## Anwendungsbeispiel\n\n\n::: {.cell}\n\n:::\n\n\n-   Szenario: Wir sollen eine Analyse zum Thema \"Heizungsarten\" durchführen, basierend auf der Gebäude- und Wohnungszählung (GWZ) und nutzen hierfür die Zensusdatenbank\n-   Wir suchen nach Objekten in der Zensusdatenbank zum Thema \"Heizung\" und ziehen aus der Ergebnis-Liste nur die Tabellen\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrestatis::gen_find(term = \"Heizung\", \n                   database = \"zensus\", \n                   verbose = FALSE) %>% \n  magrittr::extract2(\"Tables\") %>% # restatis liefert Ergebnisse i.d.R. als Listen\n  head(2) # Nur ein Auszug aus 49 Tabellen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  Code       Content                            Object_Type\n  <chr>      <chr>                              <chr>      \n1 3000G-1008 Gebäude: Energieträger der Heizung table      \n2 3000G-1011 Gebäude: Heizungsart               table      \n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel\n\n-   Alternativ: Suche über die `gen_catalogue()`-Funktion, Voraussetzung: Kenntnisse zu Statistik-Codes\n-   Bsp.: Gebäude-Daten beginnen mit **3**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncatalogue <- restatis::gen_catalogue(\"3*\", \n                                     database = \"zensus\", verbose = FALSE)\n\nprint(head(catalogue$Tables$`3 - Wohnen, Umwelt`, 7))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 3\n  Code       Content                                Object_Type\n  <chr>      <chr>                                  <chr>      \n1 3000G-1001 Gebäude: Art des Gebäudes              table      \n2 3000G-1002 Gebäude: Baujahr (Jahrzehnte)          table      \n3 3000G-1003 Gebäude: Baujahr (Jahrzwanzigste)      table      \n4 3000G-1004 Gebäude: Baujahr (Mikrozensus-Klassen) table      \n5 3000G-1005 Gebäude: Baujahr (Jahresschritte)      table      \n6 3000G-1006 Gebäude: Baujahr (Zweijahresschritte)  table      \n7 3000G-1007 Gebäude: Eigentumsform des Gebäudes    table      \n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel\n\n-   Nun wollen wir eine der Tabellen herunterladen (Gemeindeebene), <br> hierfür nutzen wir den `Code` der Tabelle\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheizung <- restatis::gen_table(name = \"3000G-1008\", \n                               database = \"zensus\")\n\nhead(heizung, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 17\n  statistics_code statistics_label  time_code time_label time  `1_variable_code`\n  <chr>           <chr>             <chr>     <chr>      <chr> <chr>            \n1 3000G           Buildings (terri… STAG      Reference… 2022… GEODL1           \n2 3000G           Buildings (terri… STAG      Reference… 2022… GEODL1           \n3 3000G           Buildings (terri… STAG      Reference… 2022… GEODL1           \n4 3000G           Buildings (terri… STAG      Reference… 2022… GEODL1           \n# ℹ 11 more variables: `1_variable_label` <chr>,\n#   `1_variable_attribute_code` <chr>, `1_variable_attribute_label` <chr>,\n#   `2_variable_code` <chr>, `2_variable_label` <chr>,\n#   `2_variable_attribute_code` <chr>, `2_variable_attribute_label` <chr>,\n#   value <chr>, value_unit <chr>, value_variable_code <chr>,\n#   value_variable_label <chr>\n```\n\n\n:::\n:::\n\n\n-   Das wollen wir nicht - es sind Daten für ganz Deutschland. Aber es scheint eine Variable mit Geo-Bezug zu geben (`GEODL1`)\n\n## Anwendungsbeispiel\n\n-   Also müssen wir sehen, welche weiteren Variablen wir noch für die Statistik (`3000G`) wählen können\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheiz_vars <- restatis::gen_var2stat(code = \"3000G\", \n                                    database = \"zensus\", \n                                    verbose = FALSE)\n\nheiz_vars$Variables[11:16,]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  Code   Content                                      Object_Type\n  <chr>  <chr>                                        <chr>      \n1 GEOBL1 Bundesländer                                 Variable   \n2 GEOBZ1 Bezirke (Hamburg und Berlin)                 Variable   \n3 GEODL1 Deutschland                                  Variable   \n4 GEOGM4 Gemeinden (Gebietsstand 15.05.2022)          Variable   \n5 GEOLK4 Landkreise u. krsfr. Städte (Stand 15.05.22) Variable   \n6 GEORB1 Regierungsbezirke/Statistische Regionen      Variable   \n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel\n\n-   `GEOGM4` ist die Variable, die wir gesucht haben\n-   Also nutzen wir sie über den Parameter `regionalvariable`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheizung <- restatis::gen_table(\"3000G-1008\", \n                               database = \"zensus\", \n                               regionalvariable = \"GEOGM4\",\n                               language = \"de\")\n\nhead(heizung[,9:17])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n  `1_variable_attribute_label` `2_variable_code` `2_variable_label`       \n  <chr>                        <chr>             <chr>                    \n1 Herborn                      GEBEN1            Energieträger der Heizung\n2 Herborn                      GEBEN1            Energieträger der Heizung\n3 Schönau a.Königssee          GEBEN1            Energieträger der Heizung\n4 Schönau a.Königssee          GEBEN1            Energieträger der Heizung\n5 Elterlein, Stadt             GEBEN1            Energieträger der Heizung\n6 Elterlein, Stadt             GEBEN1            Energieträger der Heizung\n# ℹ 6 more variables: `2_variable_attribute_code` <chr>,\n#   `2_variable_attribute_label` <chr>, value <chr>, value_unit <chr>,\n#   value_variable_code <chr>, value_variable_label <chr>\n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel\n\n-   Nun kennen wir die Tabelle, die wir möchten\n-   Aber welche Informationen gibt es zu ihr?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetadata_table <- gen_metadata(\"3000G-1011\", \n                               database = \"zensus\", category = \"table\", verbose = FALSE)\n\nprint(metadata_table$Structure$Rows)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Code     Content       Type      Updated     \n[1,] \"HZGAT1\" \"Heizungsart\" \"Merkmal\" \"see parent\"\n```\n\n\n:::\n\n```{.r .cell-code}\nmetadata_variable <- gen_metadata(\"HZGAT1\", \n                                  database = \"zensus\", category = \"variable\", verbose = FALSE)\n\nprint(metadata_variable$General)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Code     Content       Values Type      \n[1,] \"HZGAT1\" \"Heizungsart\" \"6\"    \"sachlich\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(metadata_variable$Information)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"wiki\\nDas Merkmal bezeichnet die überwiegende Heizungsart im \\nGebäude.\"\n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel\n\n-   Um die prozentualen Anteile der Energieträger pro Gemeinde zu bekommen, sind noch einige Verarbeitungen notwendig\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheizung_filter <- heizung %>% \n                    filter(`2_variable_attribute_label` != \"Insgesamt\" & \n                           value_unit == \"%\") %>% \n                    group_by(`1_variable_attribute_code`) %>% \n                    slice_max(value, with_ties = FALSE) %>% \n                    ungroup()\n\nunique(heizung_filter$`2_variable_attribute_label`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Fernwärme (verschiedene Energieträger)\"\n[2] \"Heizöl\"                                \n[3] \"Gas\"                                   \n[4] \"Holz, Holzpellets\"                     \n[5] \"Solar-/Geothermie, Wärmepumpen\"        \n[6] \"Kein Energieträger (keine Heizung)\"    \n[7] \"Strom (ohne Wärmepumpe)\"               \n[8] \"Biomasse (ohne Holz), Biogas\"          \n[9] \"Kohle\"                                 \n```\n\n\n:::\n:::\n\n\n## Anwendungsbeispiel: Ergebnis\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation-restatis_files/figure-revealjs/de_karte-1.png){width=10000}\n:::\n:::\n\n\n## Authentifizierung\n\n-   Alle drei APIs benötigen Nutzeraccounts\n-   Verschiedene Funktionen zur \"Anmeldung\"\n    -   `restatis::gen_auth_save()`: Speichere Zugangsdaten\n    -   `restatis::gen_auth_get()`: Lese Zugangsdaten aus\n    -   `restatis::gen_logincheck()`: Teste, ob Login funktioniert\n-   Alle Funktionen können für alle APIs genutzt werden, <br> für Teile von ihnen oder für nur eine\n-   Zugangsdaten werden lokal in einer verschlüsselten `.rds`-Datei gespeichert\n-   Schlüssel dazu wird in `.Renviron` gespeichert\n-   Zensusdatenbank akzeptiert auch API-Token\n\n## Sonstige Funktionalität: Datendownload\n\n-   `{restatis}` bietet weitere Funktionen für den Datendownload:\n    -   `gen_cube()`: Download von sogenannten Datenquadern, gibt es nur bei GENESIS und regionalstatistik.de, nicht beim Zensus 2022\n    -   `gen_list_jobs()`: Liste mit aktiven und fertiggestellten \"Jobs\", die erstellt werden, wenn Tabellen zu groß für den direkten Download sind (\"Jobs\" gibt es auch nur bei GENESIS und www.regionalstatistik.de)\n    -   `gen_download_job()`: Download von fertiggestellten \"Jobs\"\n-   Beispiel:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Diese Anfrage ist zu groß => Parameter job = TRUE ist nötig\nlarge_request <- restatis::gen_table(\"31111-01-02-4\", database = \"regio\")\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: You have requested a table too big for simple download. \nConsider making a range of smaller requests or use the \noption to create a job by setting the 'job' parameter \nof 'gen_table()' to TRUE. You can then download the job \nlater (use the function 'gen_list_jobs()' to check its status).\n```\n\n\n:::\n\n```{.r .cell-code}\n# large_request <- restatis::gen_table(\"31111-01-02-4\", database = \"regio\", job = TRUE)\n```\n:::\n\n\n## Sonstige Funktionalität\n\n-   Daten & Metadaten finden\n\n    -   `gen_objects2stat()`: Finde Objekte zu einer Statistik\n\n    -   `gen_objects2var()`: Finde Objekte zu einer Variablen\n\n    -   `gen_val2var()`: Extrahiere mögliche Werte einer Variablen\n\n    -   `gen_val2var2stat()`: Finde Werte einer Variable zu einer Statistik\n\n    -   `gen_search_vars()`: Suche spezifische Variablen\n\n-   Hilfsfunktionen\n\n    -   `gen_modified_data()`: Suche nach Updates, Änderungen oder neuen Objekten anhand eines spezifischen Datums\n\n    -   `gen_alternative_terms()`: Finde Suchbegriffe, die ähnlich oder verwandt sind zueinander (Schreibweise)\n\n    -   `gen_signs()`: Funktion, alle aktuellen Qualitätskennzeichen und deren Bedeutung aufzulisten (z.B., 0, \\*, X, (), p, ...)\n\n    -   `gen_update_evas()`: Funktion, um die aktuellen EVAS-Nummern von der EVAS-Seite zu scrapen\n\n## Schwesterpaket 'pystatis'\n\n<br>\n\n-   `{restatis}` verfügt über ein Python-Schwesterpaket\n-   [pystatis](https://pypi.org/project/pystatis/) ist auf PyPI zu finden\n-   Funktionalität grundsätzlich relativ ähnlich\n-   Unterstützt ebenfalls alle drei Datenbanken\n-   Die Entwicklungsversion ist auf [GitHub](https://github.com/CorrelAid/pystatis) zu finden\n\n<br>\n\n- Außerdem gibt es noch das `wiesbaden`-Paket\n  - Baut auf SOAP/XML statt auf RESTful/JSON\n  - Kein Support für die Zensusdatenbank\n\n## Danke![^1]\n\n[^1]: Diese Präsentation ist erstellt mit `Quarto` und basiert auf einer Vorlage von [Mine Cetinkaya-Rundel](https://github.com/mine-cetinkaya-rundel); Schriftart: [Fira Code Medium](https://github.com/tonsky/FiraCode).\n\n<br><br>\n\n-   `{restatis}` ist ein Open-Source-Projekt\n-   Noch kein stabiler Release (Version 0.2.0)\n-   Bitte rege benutzen und Rückmeldung geben\n-   Am besten über [GitHub](https://github.com/CorrelAid/restatis/issues)\n-   Nächste Schritte u.a.:\n    -   Umstellung von Zensusdatenbank und GENESIS zu POST (statt GET)\n\nKontakt: yannik.buhl /at/ destatis.de oder yannikbuhl (GitHub)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}